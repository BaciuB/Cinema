<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Halls</title>

    <style>
        .field-error {
            color: red;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        .success-message {
            color: green;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        .box {
            border: 1px solid #999;
            padding: 12px;
            width: 320px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>

<h1>Halls</h1>

<div th:if="${globalError}" class="field-error" th:text="${globalError}"></div>
<div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>

<div class="box">
    <div style="font-weight:bold; margin-bottom:8px;">Filter + Sort</div>

    <form th:action="@{/halls}" method="get">
        <div>
            <label>Name contains</label><br>
            <input type="text" name="name" th:value="${name}">
        </div>

        <div>
            <label>Theatre</label><br>
            <select name="theatreId">
                <option value="" th:selected="${theatreId == null or theatreId == ''}">-- any --</option>
                <option th:each="t : ${theatres}"
                        th:value="${t.id}"
                        th:text="${t.name}"
                        th:selected="${theatreId == t.id}">
                </option>
            </select>
        </div>

        <div>
            <label>Min capacity</label><br>
            <input type="number" name="minCapacity" th:value="${minCapacity}">
        </div>

        <div>
            <label>Max capacity</label><br>
            <input type="number" name="maxCapacity" th:value="${maxCapacity}">
        </div>

        <hr>

        <div>
            <label>Sort by</label><br>
            <select name="sortBy">
                <option value="id" th:selected="${sortBy == 'id'}">ID</option>
                <option value="name" th:selected="${sortBy == 'name'}">Name</option>
                <option value="capacity" th:selected="${sortBy == 'capacity'}">Capacity</option>
                <option value="theatre" th:selected="${sortBy == 'theatre'}">Theatre</option>
            </select>
        </div>

        <div>
            <label>Direction</label><br>
            <select name="dir">
                <option value="ASC" th:selected="${dir == 'ASC'}">ASC</option>
                <option value="DESC" th:selected="${dir == 'DESC'}">DESC</option>
            </select>
        </div>

        <div>
            <label>Page size</label><br>
            <select name="size">
                <option value="5" th:selected="${size == 5}">5</option>
                <option value="10" th:selected="${size == 10}">10</option>
                <option value="20" th:selected="${size == 20}">20</option>
            </select>
        </div>

        <input type="hidden" name="page" value="0">

        <p style="margin-top:10px;">
            <button type="submit">Apply</button>
            <a th:href="@{/halls}">Reset</a>
        </p>
    </form>
</div>

<p><a th:href="@{/halls/new}">Add new Hall</a></p>

<table border="1" cellpadding="5" cellspacing="0">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Capacity</th>
        <th>Theatre</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>

    <tr th:if="${#lists.isEmpty(halls)}">
        <td colspan="5" style="text-align:center; color:gray;">No halls found.</td>
    </tr>

    <tr th:each="h : ${halls}">
        <td th:text="${h.id}"></td>
        <td th:text="${h.name}"></td>
        <td th:text="${h.capacity}"></td>
        <td th:text="${h.theatre != null ? h.theatre.name : 'N/A'}"></td>
        <td>
            <a th:href="@{'/halls/' + ${h.id}}">Details</a> |
            <a th:href="@{'/halls/' + ${h.id} + '/edit'}">Edit</a>
            <form th:action="@{'/halls/' + ${h.id} + '/delete'}"
                  method="post"
                  style="display:inline">
                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>

    </tbody>
</table>

<p th:if="${hallsPage.totalPages > 1}">
    <span th:text="${hallsPage.number + 1}"></span>/<span th:text="${hallsPage.totalPages}"></span>

    <a th:if="${hallsPage.hasPrevious()}"
       th:href="@{/halls(name=${name},theatreId=${theatreId},minCapacity=${minCapacity},maxCapacity=${maxCapacity},sortBy=${sortBy},dir=${dir},size=${size},page=${hallsPage.number - 1})}">Prev</a>

    <a th:if="${hallsPage.hasNext()}"
       th:href="@{/halls(name=${name},theatreId=${theatreId},minCapacity=${minCapacity},maxCapacity=${maxCapacity},sortBy=${sortBy},dir=${dir},size=${size},page=${hallsPage.number + 1})}">Next</a>
</p>

<p><a th:href="@{/}">Back home</a></p>

</body>
</html>
