<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movies</title>

    <style>
        .field-error { color: red; font-weight: bold; margin-bottom: 10px; display:block; }
        .success-message { color: green; font-weight: bold; margin-bottom: 10px; display:block; }
        .box { border:1px solid #999; padding:12px; margin:12px 0; width: 360px; }
        table { border-collapse: collapse; }
        th, td { padding:6px 10px; }
    </style>
</head>
<body>

<h1>Movies</h1>

<div th:if="${globalError}" class="field-error" th:text="${globalError}"></div>
<div th:if="${successMessage}" class="success-message" th:text="${successMessage}"></div>

<div class="box">
    <h3>Filter + Sort</h3>

    <form th:action="@{/movies}" method="get">
        <div>
            <label>Title contains</label><br>
            <input type="text" name="title" th:value="${title}">
        </div>

        <div>
            <label>Min duration</label><br>
            <input type="number" name="minDuration" th:value="${minDuration}">
        </div>

        <div>
            <label>Max duration</label><br>
            <input type="number" name="maxDuration" th:value="${maxDuration}">
        </div>

        <div>
            <label>Release from</label><br>
            <input type="date" name="releaseFrom" th:value="${releaseFrom}">
        </div>

        <div>
            <label>Release to</label><br>
            <input type="date" name="releaseTo" th:value="${releaseTo}">
        </div>

        <hr>

        <div>
            <label>Sort by</label><br>
            <select name="sortBy">
                <option value="id" th:selected="${sortBy == 'id'}">ID</option>
                <option value="title" th:selected="${sortBy == 'title'}">Title</option>
                <option value="durationMinutes" th:selected="${sortBy == 'durationMinutes'}">Duration</option>
                <option value="release_date" th:selected="${sortBy == 'release_date'}">Release date</option>
            </select>
        </div>

        <div>
            <label>Direction</label><br>
            <select name="dir">
                <option value="ASC" th:selected="${dir == 'ASC'}">ASC</option>
                <option value="DESC" th:selected="${dir == 'DESC'}">DESC</option>
            </select>
        </div>

        <div>
            <label>Page size</label><br>
            <select name="size">
                <option value="5" th:selected="${size == 5}">5</option>
                <option value="10" th:selected="${size == 10}">10</option>
                <option value="20" th:selected="${size == 20}">20</option>
            </select>
        </div>

        <p>
            <button type="submit">Apply</button>
            <a th:href="@{/movies}">Reset</a>
        </p>
    </form>
</div>

<p><a th:href="@{/movies/new}">Add new Movie</a></p>

<table border="1" cellpadding="5" cellspacing="0">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Duration (min)</th>
        <th>Release Date</th>
        <th># Screenings</th>
        <th>Actions</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="m : ${moviesPage.content}">
        <td th:text="${m.id}"></td>
        <td th:text="${m.title}"></td>
        <td th:text="${m.durationMinutes}"></td>
        <td th:text="${m.release_date}"></td>
        <td th:text="${m.screenings != null ? #lists.size(m.screenings) : 0}"></td>
        <td>
            <a th:href="@{'/movies/' + ${m.id}}">Details</a> |
            <a th:href="@{'/movies/' + ${m.id} + '/edit'}">Edit</a>
            <form th:action="@{'/movies/' + ${m.id} + '/delete'}"
                  method="post"
                  style="display:inline">
                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<p th:if="${moviesPage.totalPages > 1}">
    <span th:text="${moviesPage.number + 1}"></span>/<span th:text="${moviesPage.totalPages}"></span>

    <a th:if="${moviesPage.hasPrevious()}"
       th:href="@{/movies(title=${title},minDuration=${minDuration},maxDuration=${maxDuration},releaseFrom=${releaseFrom},releaseTo=${releaseTo},sortBy=${sortBy},dir=${dir},size=${size},page=${moviesPage.number - 1})}">Prev</a>

    <a th:if="${moviesPage.hasNext()}"
       th:href="@{/movies(title=${title},minDuration=${minDuration},maxDuration=${maxDuration},releaseFrom=${releaseFrom},releaseTo=${releaseTo},sortBy=${sortBy},dir=${dir},size=${size},page=${moviesPage.number + 1})}">Next</a>
</p>

<p><a th:href="@{/}">Back home</a></p>

</body>
</html>
